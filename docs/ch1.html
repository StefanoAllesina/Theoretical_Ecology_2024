<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Theoretical Ecology – ch1</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Theoretical Ecology</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" rel="" target="" aria-current="page">
 <span class="menu-text">Lecture notes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./ch1.html">Models for a single population</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lecture notes, Part 1: Population Dynamics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch1.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Models for a single population</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Models for two populations</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Models for disease dynamics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ch4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Disease models</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#models-for-a-single-population" id="toc-models-for-a-single-population" class="nav-link active" data-scroll-target="#models-for-a-single-population">Models for a single population</a>
  <ul class="collapse">
  <li><a href="#a-simple-model-for-non-overlapping-generations" id="toc-a-simple-model-for-non-overlapping-generations" class="nav-link" data-scroll-target="#a-simple-model-for-non-overlapping-generations">A simple model for non-overlapping generations</a></li>
  <li><a href="#overlapping-generations-exponential-growth" id="toc-overlapping-generations-exponential-growth" class="nav-link" data-scroll-target="#overlapping-generations-exponential-growth">Overlapping generations: exponential growth</a>
  <ul class="collapse">
  <li><a href="#doubling-time" id="toc-doubling-time" class="nav-link" data-scroll-target="#doubling-time">Doubling time</a></li>
  </ul></li>
  <li><a href="#logistic-growth" id="toc-logistic-growth" class="nav-link" data-scroll-target="#logistic-growth">Logistic growth</a></li>
  <li><a href="#qualitative-analysis" id="toc-qualitative-analysis" class="nav-link" data-scroll-target="#qualitative-analysis">Qualitative analysis</a>
  <ul class="collapse">
  <li><a href="#a-graphical-method" id="toc-a-graphical-method" class="nav-link" data-scroll-target="#a-graphical-method">A graphical method</a></li>
  <li><a href="#local-asymptotic-stability" id="toc-local-asymptotic-stability" class="nav-link" data-scroll-target="#local-asymptotic-stability">Local asymptotic stability</a></li>
  <li><a href="#global-asymptotic-stability" id="toc-global-asymptotic-stability" class="nav-link" data-scroll-target="#global-asymptotic-stability">Global Asymptotic Stability</a></li>
  <li><a href="#long-term-behavior" id="toc-long-term-behavior" class="nav-link" data-scroll-target="#long-term-behavior">Long-term behavior</a></li>
  </ul></li>
  <li><a href="#discrete-time-models" id="toc-discrete-time-models" class="nav-link" data-scroll-target="#discrete-time-models">Discrete-time models</a>
  <ul class="collapse">
  <li><a href="#graphical-methods-cobwebbing" id="toc-graphical-methods-cobwebbing" class="nav-link" data-scroll-target="#graphical-methods-cobwebbing">Graphical Methods: Cobwebbing</a></li>
  <li><a href="#the-logistic-map" id="toc-the-logistic-map" class="nav-link" data-scroll-target="#the-logistic-map">The logistic map</a></li>
  <li><a href="#stability-of-equilibria" id="toc-stability-of-equilibria" class="nav-link" data-scroll-target="#stability-of-equilibria">Stability of equilibria</a></li>
  <li><a href="#periodic-orbits" id="toc-periodic-orbits" class="nav-link" data-scroll-target="#periodic-orbits">Periodic orbits</a></li>
  <li><a href="#chaos" id="toc-chaos" class="nav-link" data-scroll-target="#chaos">Chaos</a></li>
  <li><a href="#bifurcation-diagram" id="toc-bifurcation-diagram" class="nav-link" data-scroll-target="#bifurcation-diagram">Bifurcation diagram</a></li>
  </ul></li>
  <li><a href="#classic-papers" id="toc-classic-papers" class="nav-link" data-scroll-target="#classic-papers">Classic papers</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">



<section id="models-for-a-single-population" class="level1">
<h1>Models for a single population</h1>
<section id="a-simple-model-for-non-overlapping-generations" class="level2">
<h2 class="anchored" data-anchor-id="a-simple-model-for-non-overlapping-generations">A simple model for non-overlapping generations</h2>
<p>Consider a population reproducing annually, with non-overlapping generations. Over its lifetime, each individual produces <span class="math inline">\(\rho\)</span> offspring, which form the next generation. Then, we can write:</p>
<p><span class="math display">\[
x_{k+1} = \rho x_k
\]</span></p>
<p>where <span class="math inline">\(x_k\)</span> is the number of individuals/area at generation <span class="math inline">\(k\)</span>. Naturally, we can iterate again, and find the population density at time <span class="math inline">\(x_{k+2}\)</span>:</p>
<p><span class="math display">\[
x_{k+2} = \rho x_{k+1} = \rho^2 x_{k}
\]</span></p>
<p>and in general:</p>
<p><span class="math display">\[
x_{n} = \rho^n x_0
\]</span></p>
<p>where <span class="math inline">\(x_0\)</span> is the initial population size, and <span class="math inline">\(n\)</span> is the number of generations since we started tracking the population. We assume <span class="math inline">\(x_0&gt;0\)</span>, and thus the population grows whenever <span class="math inline">\(\rho &gt; 1\)</span>, declines whenever <span class="math inline">\(\rho &lt; 1\)</span>, and is constant whenever <span class="math inline">\(\rho = 1\)</span>. Armed with <span class="math inline">\(x_0\)</span> and <span class="math inline">\(\rho\)</span>, we can project the population forward in time for an arbitrary number of generations.</p>
</section>
<section id="overlapping-generations-exponential-growth" class="level2">
<h2 class="anchored" data-anchor-id="overlapping-generations-exponential-growth">Overlapping generations: exponential growth</h2>
<p>Take the population density at time <span class="math inline">\(t\)</span> and <span class="math inline">\(t + \Delta t\)</span>; in the time interval <span class="math inline">\(\Delta t\)</span> the change in population density is <span class="math inline">\(x(t + \Delta t) - x(t)\)</span>, and the average change per unit of time is <span class="math inline">\((x(t + \Delta t) - x(t))/\Delta t\)</span>. We can consider the limit in which the interval <span class="math inline">\(\Delta t\)</span> shrinks to zero:</p>
<p><span class="math display">\[
\lim_{\Delta t \to 0} \dfrac{x(t + \Delta t) - x(t)}{\Delta t} = \frac{dx(t)}{dt}
\]</span></p>
<p>In fact, this is exactly the definition of the derivative with respect to (w.r.t.) time of the function <span class="math inline">\(x(t)\)</span>. A great contribution of Newton and Leibniz was to recognize that many natural phenomena can be described by simple differential equations—even though the equations describing the rate of change <span class="math inline">\(dx(t)/dt\)</span> are simple, the behavior of the solutions <span class="math inline">\(x(t)\)</span> can be incredibly complex.</p>
<p>In ecology and evolutionary biology, one encounters two main types of differential equations:</p>
<ul>
<li><p><em>Ordinary differential equations</em> (ODEs) describe the rate of change of a quantity (in our case, population densities, <span class="math inline">\(x(t)\)</span>) as a function of an independent variable (in our case, the time <span class="math inline">\(t\)</span>), and can contain functions of the quantity, and its derivatives. If only the first derivative (<span class="math inline">\(dx(t)/dt\)</span>) is included, it is called a first-order ODE.</p></li>
<li><p><em>Partial differential equations</em> (PDEs) contain more than one independent variable (e.g., time and coordinates in space). Therefore, the quantity of interest is a multivariate function, such as <span class="math inline">\(q(x,y,t)\)</span>, denoting the density of a population at the coordinates <span class="math inline">\(x,y\)</span> and time <span class="math inline">\(t\)</span>. The partial derivatives with respect to the independent variables are considered, hence the name.</p></li>
</ul>
<p>Many other types of differential equations (stochastic differential equations, SDEs; integro-differential equations, IDEs; etc.) are found in certain technical areas.</p>
<p>In this class, we will deal exclusively with ODEs of the form:</p>
<p><span class="math display">\[
\dfrac{dx(t)}{dt} = f(x(t))
\]</span></p>
<p>where the function <span class="math inline">\(f(x(t))\)</span> models different ecological phenomena influencing the growth and decline of populations. For example, take populations growing thanks to the per-capita birth rate <span class="math inline">\(\beta\)</span>, and declining due to the death rate <span class="math inline">\(\delta\)</span>:</p>
<p><span class="math display">\[
\dfrac{dx(t)}{dt} = \beta x(t) - \delta x(t) = (\beta - \delta) x(t) = \rho\, x(t)
\]</span></p>
<p>here the <em>intrinsic growth rate</em> <span class="math inline">\(\rho\)</span> represents the difference between birth and death rates. The parameter is taken to be independent of time, yielding an <em>autonomous</em> differential equation. An ODE is autonomous if it does not depend explicitly on the independent variable (in our case, time). I.e., if <span class="math inline">\(dx/dt = f(x(t))\)</span> the system is autonomous, while <span class="math inline">\(dx/dt = g(x(t),t)\)</span> is not.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Separation of variables
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>A differential equation for <span class="math inline">\(x(t)\)</span> is called separable, if it can be written as:</p>
<p><span class="math display">\[
\frac{dx(t)}{dt} = g(t)\, h(x(t))
\]</span></p>
<p>where <span class="math inline">\(g(t)\)</span> is a function of <span class="math inline">\(t\)</span>, and <span class="math inline">\(h(x(t))\)</span> a function of <span class="math inline">\(x(t)\)</span>. As long as <span class="math inline">\(h(x(t)) \neq 0\)</span>, we can formally write:</p>
<p><span class="math display">\[
\frac{1}{h(x(t))} dx(t) = g(t)\, dt
\]</span></p>
<p>We can now integrate both sides, obtaining</p>
<p><span class="math display">\[
\begin{aligned}
\int \frac{1}{h(x(t))} dx(t) + \mathcal c_1 &amp;= \int g(t)\, dt + \mathcal c_2\\
\int \frac{1}{h(x(t))} dx(t) &amp;= \int g(t)\, dt + \mathcal c
\end{aligned}
\]</span></p>
<p>where <span class="math inline">\(\mathcal c_1, \mathcal c_2\)</span> and <span class="math inline">\(\mathcal c = \mathcal c_2 - \mathcal c_1\)</span> are constants of integration, whose value can be set by considering the initial conditions.</p>
<p><strong>Example</strong></p>
<p>Consider:</p>
<p><span class="math display">\[
\frac{dx(t)}{dt} = \alpha
\]</span></p>
<p>with initial condition <span class="math inline">\(x(0) = x_0\)</span>. Separate the variables and integrate:</p>
<p><span class="math display">\[
\begin{aligned}
d x(t) &amp;= \alpha\, dt\\
\int d x(t) &amp;= \alpha \int dt + \mathcal c\\
x(t) &amp;= \alpha t + \mathcal c
\end{aligned}
\]</span></p>
<p>Now substitute the initial condition:</p>
<p><span class="math display">\[
x(0) = x_0 = \alpha 0 + c  = c
\]</span></p>
<p>Yielding the solution:</p>
<p><span class="math display">\[
x(t) = x_0 + \alpha t
\]</span></p>
<p>A solution of an <em>initial-value</em> problem is an equation which, given the values of the parameters (<span class="math inline">\(\alpha\)</span>, in this case) and the initial conditions (<span class="math inline">\(x_0\)</span>, in this case), allows us to determine the value of the dependent variable (<span class="math inline">\(x(t)\)</span>) for any value of the independent variable (<span class="math inline">\(t\)</span>). Only relatively simple ODEs or systems of ODEs can be solved explicitly.</p>
</div>
</div>
</div>
<p>We can solve the differential equation:</p>
<p><span class="math display">\[
\begin{aligned}
\dfrac{dx}{dt} &amp;= \rho\, x\\
\dfrac{1}{x}\,dx &amp;= \rho\, dt
\end{aligned}
\]</span></p>
<p>Integrate both sides</p>
<p><span class="math display">\[
\begin{aligned}
\int \dfrac{1}{x}\,dx &amp;= \int \rho\, dt\\
\log x &amp;= \rho\, t + \mathcal c\\
x &amp;= e^{\rho\, t  + \mathcal c}\\
x &amp;= e^{\rho\, t} e^\mathcal c\\
\end{aligned}
\]</span></p>
<p>where <span class="math inline">\(\mathcal c\)</span> is a constant of integration. Then, we can plug in the initial condition: at <span class="math inline">\(t=0\)</span>, the population is at density <span class="math inline">\(x_0\)</span>:</p>
<p><span class="math display">\[
\begin{aligned}
x_0 &amp;= e^{\rho\, 0}e^{\mathcal c}\\
x_0 &amp;= e^\mathcal c
\end{aligned}
\]</span></p>
<p>We obtain the solution:</p>
<p><span class="math display">\[
x(t) = x(0) e^{\rho\, t}
\]</span></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Integrating differential equations numerically
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>You can compute <span class="math inline">\(x(t)\)</span> for any differential equation (or system of differential equations) in <code>R</code> using numerical techniques. Your code needs to include two parts:</p>
<p>First, we write a function defining the (system of) ODE(s). This function takes three arguments: <code>t</code>, the time, <code>x</code>, the state of the system, and <code>parms</code>, a list of parameters, and returns a <code>list</code> containing <span class="math inline">\(dx/dt\)</span>. For the exponential growth, we can write:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>exponential_growth <span class="ot">&lt;-</span> <span class="cf">function</span>(t, x, parms){</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  dxdt <span class="ot">&lt;-</span> x <span class="sc">*</span> parms<span class="sc">$</span>rho</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(dxdt))</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Because ecological models only make sense for positive population densities, we can set an arbitrarily small threshold, and consider the population extinct if it falls below the threshold:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>THRESH <span class="ot">&lt;-</span> <span class="dv">10</span><span class="sc">^-</span><span class="dv">10</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>exponential_growth <span class="ot">&lt;-</span> <span class="cf">function</span>(t, x, parms){</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(x <span class="sc">&lt;</span> THRESH) x <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  dxdt <span class="ot">&lt;-</span> x <span class="sc">*</span> parms<span class="sc">$</span>rho</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(dxdt))</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The second part of the code invokes the numerical integration function <code>ode</code>. For this function, we need to set a) initial conditions, b) determine at which times do we want to observe the state of the population, c) specify the name of the function to use, d) the parameters to use, and e) (optional) specify the method to use for the integration. The function <code>ode</code> is part of the package <code>deSolve</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>x0 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># initial conditions</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>my_time <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="at">by =</span> <span class="fl">0.1</span>) <span class="co"># we will observe the system at these times</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>parms <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">rho =</span> <span class="fl">1.05</span>) <span class="co"># list of parameters</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>output <span class="ot">&lt;-</span> <span class="fu">ode</span>(<span class="at">y =</span> x0, <span class="co"># a) initial conditions</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">times =</span> my_time,  <span class="co"># b) time at which we observe the system</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">func =</span> exponential_growth, <span class="co"># c) function computing r.h.s. of ODEs</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">parms =</span> parms, <span class="co"># d) parameters of ODEs</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">method =</span> <span class="st">"ode45"</span>) <span class="co"># e) more on this later; this is a good general-purpose choice</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The output is a matrix of class <code>deSolve</code>, containing the time in the first column, and the values of <span class="math inline">\(x(t)\)</span> in the second. For plotting, it is best to convert this into a data frame:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>output <span class="sc">%&gt;%</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> <span class="st">`</span><span class="at">1</span><span class="st">`</span>) <span class="sc">+</span> </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"t"</span>) <span class="sc">+</span> </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(<span class="fu">x</span>(t))) <span class="sc">+</span> </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ch1_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</div>
<section id="doubling-time" class="level3">
<h3 class="anchored" data-anchor-id="doubling-time">Doubling time</h3>
<p>How long will it take for a growing population (<span class="math inline">\(\rho &gt; 0\)</span>) to double in density? We are looking for <span class="math inline">\(\tau\)</span> such that <span class="math display">\[
\begin{aligned}
x(\tau) &amp;= 2 x_0\\
x_0 e^{\rho \tau} &amp;= 2 x_0\\
e^{\rho \tau} &amp;= 2\\
\rho \tau &amp;= \log 2\\
\tau &amp;= \dfrac{\log 2}{\rho}
\end{aligned}
\]</span></p>
<p>Thus, the doubling time does not depend on the initial condition: the population will keep doubling every <span class="math inline">\(\log 2 / \rho\)</span> units of time. For example, take <span class="math inline">\(\rho = 0.01\)</span>, then <span class="math inline">\(\tau \approx 30\)</span>: a population growing exponentially with rate of 1% per year will double every 30 years or so. Then, a growth of 3% doubles every 10 years, etc.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise: Radiocarbon dating
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>While at the University of Chicago, Willard Libby (Nobel Laureate in Chemistry, 1960) pioneered radiocarbon dating. The carbon isotope <span class="math inline">\({}^{14}\)</span>C is constantly being created in the Earth’s atmosphere by the interaction of cosmic rays with atmospheric nitrogen. The carbon combines with oxygen, to form CO<span class="math inline">\({}_2\)</span> that is then absorbed by plants. When plants die, the isotope decays in their tissues. Radioactive decay follows the exponential model:</p>
<p><span class="math display">\[
N(t) = e^{\lambda t} N(0)
\]</span></p>
<p>where <span class="math inline">\(\lambda &lt; 0\)</span> is the decay rate of the isotope. The half-life of a radioisotope is the time it takes to be reduced to half of the original concentration, and is 5,730 years for <span class="math inline">\({}^{14}\)</span>C.</p>
<ul>
<li>Find the value of <span class="math inline">\(\lambda\)</span> for <span class="math inline">\({}^{14}\)</span>C given its half-life</li>
<li>Express <span class="math inline">\(t\)</span> as a function of <span class="math inline">\(\lambda\)</span>, and the ratio between <span class="math inline">\(N(t)\)</span> and <span class="math inline">\(N(0)\)</span></li>
<li>The concentration in the atmosphere is about 1 atom of <span class="math inline">\({}^{14}\)</span>C for every <span class="math inline">\(10^{12}\)</span> atoms of carbon. You have a collected sample that contains <span class="math inline">\(1/16\)</span> atoms of <span class="math inline">\({}^{14}\)</span>C for every <span class="math inline">\(10^{12}\)</span> atoms of carbon; date the sample.</li>
</ul>
</div>
</div>
</div>
</section>
</section>
<section id="logistic-growth" class="level2">
<h2 class="anchored" data-anchor-id="logistic-growth">Logistic growth</h2>
<p>We have a population that grows exponentially when at very low densities, but experiences a slow down in growth when densities are higher. The logistic growth equation is typically written as:</p>
<p><span class="math display">\[
\frac{d X}{d \tau} = X\left(\rho - \alpha X\right)
\]</span></p>
<p>where <span class="math inline">\(\rho&gt;0\)</span> is the intrinsic growth rate of the population, and <span class="math inline">\(\alpha&gt;0\)</span> is a parameter that regulates the amount by which growth is decreased as <span class="math inline">\(X\)</span> increases.</p>
<p>An <em>equilibrium</em> (steady-state, fixed point) of a differential equation is a value of the dependent variable (<span class="math inline">\(X(t)\)</span>) that makes the right-hand side of the equation zero. We denote an equilibrium as <span class="math inline">\(X^\star\)</span>. We can write:</p>
<p><span class="math display">\[
\left.\dfrac{dX}{d\tau}\right|_{X^\star} = 0
\]</span></p>
<p>i.e., the differential equation, evaluated at the point <span class="math inline">\(X^\star\)</span> is zero: the population will not grow nor decline, but rather will remain at <span class="math inline">\(X^\star\)</span>. The logistic equation has two equilibria: <span class="math inline">\(X^\star=0\)</span> (absence of the population), and <span class="math inline">\(\rho = \alpha X^\star\)</span>, <span class="math inline">\(X^\star = \rho / \alpha = \kappa\)</span>, called the <em>carrying capacity</em> of the population.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Chain rule
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>This is one of the most useful formulas from calculus. It relates the derivative of the composition of two differentiable functions with the derivatives of the functions. If <span class="math inline">\(h(x) = g(u)\)</span> and <span class="math inline">\(u = f(x)\)</span>, then:</p>
<p><span class="math display">\[
\dfrac{dh}{dx} = \dfrac{dg}{du}\dfrac{du}{dx}
\]</span></p>
<p>As put by George Simmons [Calculus with Analytic Geometry (1985)]: <em>If a car travels twice as fast as a bicycle and the bicycle is four times as fast as a walking man, then the car travels 2 × 4 = 8 times as fast as the man.</em></p>
<p><strong>Example</strong></p>
<p>Take</p>
<p><span class="math display">\[
\dfrac{dx(t)}{dt} = x(t) f(x(t))
\]</span></p>
<p>and write the ODE describing <span class="math inline">\(d \log x(t) /dt\)</span>. We can write this function as the derivative of the composition <span class="math inline">\(\log x(t) = \log u\)</span> and <span class="math inline">\(u = x(t)\)</span>. Then, by chain rule:</p>
<p><span class="math display">\[
\begin{aligned}
\dfrac{d \log x(t)}{dt} &amp;= \dfrac{d \log u}{du} \dfrac{du}{dt}\\
&amp;= \dfrac{1}{u} \dfrac{du}{dt}\\
&amp;= \dfrac{1}{x(t)} \dfrac{d x(t)}{dt}\\
&amp;= \dfrac{1}{x(t)}  x(t) f(x(t))\\
&amp;= f(x(t))
\end{aligned}
\]</span></p>
<p>showing that the per-capita rate of change:</p>
<p><span class="math display">\[
\dfrac{1}{x(t)} \dfrac{dx(t)}{dt} = \dfrac{\log x(t)}{dt}
\]</span></p>
<p>is the derivative in time of the logarithm of the density of the population.</p>
</div>
</div>
</div>
<p>We can simplify the analysis of the differential equation by rescaling all the variables by positive quantities, thus obtaining a simpler form that retains the behavior of the original equation.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Nondimensionalization
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Ecological models can have many parameters, and the goal of nondimensionalization is to rewrite the equations using as few parameters as possible, via a change of variables. Importantly, the new system and the original one are equivalent, and share the same dynamics. In fact, the trajectories of the original system can be reconstructed from those of the simpler system by inverting the transformation.</p>
<p>To perform nondimensionalization:</p>
<ul>
<li>identify all the variables that depend on time (<span class="math inline">\(X(\tau)\)</span>, <span class="math inline">\(Y(\tau)\)</span>, etc.), as well as the independent variable (the time, <span class="math inline">\(\tau\)</span>)</li>
<li>replace each of them by a scaled version: <span class="math inline">\(X = c_x x\)</span>, <span class="math inline">\(Y = c_y y\)</span>, <span class="math inline">\(t = c_t \tau\)</span>, in which <span class="math inline">\(c_i\)</span> are positive constants to be determined, and rewrite the equations for the new variables</li>
<li>choose the values for the constants to eliminate as many parameters as possible. Generally, one should be able to remove one parameter for each dependent variable, plus one parameter by scaling the time.</li>
</ul>
<p><strong>Example</strong></p>
<p>The exponential growth equation has a single parameter:</p>
<p><span class="math display">\[
\frac{dx}{d\tau} = \rho x
\]</span></p>
<p>one can define <span class="math inline">\(t = c_1 \tau\)</span>, obtaining:</p>
<p><span class="math display">\[
\begin{aligned}
\frac{1}{c_1}\frac{dx}{dt} &amp;= \rho x\\
\frac{dx}{dt} &amp;= c_1 \rho x\\
\frac{dx}{dt} &amp;= x
\end{aligned}
\]</span></p>
<p>where we have chosen <span class="math inline">\(c_1 = 1/\rho\)</span>.</p>
</div>
</div>
</div>
<p>We rewrite the equation for the logistic growth by choosing <span class="math inline">\(x = c_1 X\)</span> and <span class="math inline">\(t = c_2 \tau\)</span>. Our equations become (use the chain rule):</p>
<p><span class="math display">\[
\begin{aligned}
\dfrac{c_1}{c_2}\dfrac{dx}{dt} &amp;= c_1 x (\rho - \alpha c_1 x)\\
\dfrac{dx}{dt} &amp;= x (\rho c_2 - \alpha c_1 c_2 x)\\
\end{aligned}
\]</span></p>
<p>We choose <span class="math inline">\(c_2 = 1/\rho\)</span> to make the first coefficient in parenthesis be equal to 1; then, we choose <span class="math inline">\(c_1 = \rho/\alpha\)</span> to make the second coefficient be 1:</p>
<p><span class="math display">\[
\dfrac{dx}{dt} = x (1 - x)
\]</span></p>
<p>Note that, in practice, we have chosen to rescale the variables using the intrinsic growth rate, <span class="math inline">\(t = \tau / \rho\)</span>, and the carrying capacity, <span class="math inline">\(x = X \alpha / \rho = X / \kappa\)</span>.</p>
<p>The logistic equation can be solved, because it is separable:</p>
<p><span class="math display">\[
\begin{aligned}
\dfrac{1}{x(1-x)} dx &amp;= dt\\
\left(\dfrac{1}{x}-\dfrac{1}{x-1}\right)dx &amp;= dt\\
\int \dfrac{1}{x} dx - \int \dfrac{1}{1-x} dx &amp;= \int dt + \mathcal c\\
\log x - \log(x-1)&amp;= t + c\\
\log \dfrac{x}{x-1}&amp;= t + c\\
\dfrac{x}{x-1} &amp;= e^t e^c\\
x &amp;= \dfrac{e^t e^c}{e^t e^c - 1}\\
x &amp;= \dfrac{1}{1 - e^{-t}e^{-c}}
\end{aligned}
\]</span></p>
<p>Plugging in <span class="math inline">\(x_0\)</span> when <span class="math inline">\(t=0\)</span>, we find the value for the constant of proportionality:</p>
<p><span class="math display">\[
\begin{aligned}
x_0 &amp;= \frac{e^c}{e^c - 1}\\
e^c &amp;= \frac{x_0}{x_0 - 1}
\end{aligned}
\]</span></p>
<p>Yielding the solution</p>
<p><span class="math display">\[
x(t) = \dfrac{x_0 e^t}{1 + (e^t - 1)x_0}
\]</span></p>
</section>
<section id="qualitative-analysis" class="level2">
<h2 class="anchored" data-anchor-id="qualitative-analysis">Qualitative analysis</h2>
<p>As shown for the logistic growth, solving ODEs can be very hard, and for most equations found in ecology a closed-form solution cannot be found. Moreover, even when we can solve the equations, the solution might be difficult to interpret or overly complex. Important information on the behavior of the system can be found by performing a qualitative analysis of the system. Here we concentrate on the location of equilibria, and their stability.</p>
<section id="a-graphical-method" class="level3">
<h3 class="anchored" data-anchor-id="a-graphical-method">A graphical method</h3>
<p>For any first-order ODE with a single dependent variable, one can understand the behavior of the system by simply plotting <span class="math inline">\(dx(t)/dt\)</span> (y-axis) vs <span class="math inline">\(x(t)\)</span> (x-axis). For example, for the logistic model:</p>
<p><span class="math display">\[
\dfrac{dx}{dt} = x(1-x)
\]</span></p>
<div class="cell">
<div class="cell-output-display">
<p><img src="ch1_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Showing that there are two equilibria (<span class="math inline">\(x^\star =0\)</span>, and <span class="math inline">\(x^\star = 1\)</span>), corresponding to the points where the curve <span class="math inline">\(dx/dt\)</span> intercepts the x-axis. The function <span class="math inline">\(dx/dt\)</span> is positive whenever <span class="math inline">\(0&lt;x&lt;1\)</span>, and is negative when <span class="math inline">\(x&gt;1\)</span>. Thus, the population will grow in time when <span class="math inline">\(0&lt;x&lt;1\)</span>, eventually reaching <span class="math inline">\(x^\star = 1\)</span>; similarly, if we start the population at a density that is larger than the equilibrium, it will decline, again eventually reaching <span class="math inline">\(x^\star = 1\)</span>. We therefore say that <span class="math inline">\(x^\star = 1\)</span> is <em>asymptotically stable</em>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Asymptotic stability
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>There are two useful notions of equilibrium stability for dynamical systems. We state them informally; you can find a more rigorous definition in any book on dynamical systems.</p>
<p><strong>Lyapunov stability</strong> For a given dynamical system <span class="math inline">\(dx(t)/dt\)</span>, <span class="math inline">\(x^\star\)</span> is Lyapunov stable if trajectories starting close to <span class="math inline">\(x^\star\)</span> remain close to it, indefinitely. More formally, we define a neighborhood of <span class="math inline">\(x^\star\)</span>, <span class="math inline">\(\| x(0) - x^\star\| &lt; \delta\)</span>; then <span class="math inline">\(x^\star\)</span> is Lyapunov stable if <span class="math inline">\(\| x(t) - x^\star\| &lt; \epsilon\)</span> for every <span class="math inline">\(t\)</span>, where <span class="math inline">\(\epsilon &gt; 0\)</span>.</p>
<p><strong>Asymptotic stability</strong> An equilibrium is asymptotically stable if it is Lyapunov stable, and trajectories eventually converge to <span class="math inline">\(x^\star\)</span>: <span class="math inline">\(x^\star\)</span> is asymptotically stable if there exist a neighborhood <span class="math inline">\(\| x(0) - x^\star\| &lt; \delta\)</span> such that <span class="math inline">\(\lim_{t\to\infty}\| x(t) - x^\star\| = 0\)</span>.</p>
</div>
</div>
</div>
<p>The logistic model assumes that the per capita growth rate is higher at low densities. This assumption may not be realistic for all species: when the density is low, for example, it can be more difficult to find a partner and defend against predators. This phenomenon of lower per capita growth rates at low densities, and higher per capita growth at high densities—which can also be called <em>positive density-dependence</em>—is known as the <em>Allee effect</em>. It is named after Warder Clyde Allee (1885-1955), who received his PhD from the University of Chicago and was later a professor and chair of Zoology. We could model this effect with the following equation:</p>
<p><span class="math display">\[
\dfrac{dX}{dt} = X\left(\dfrac{u X}{v + X} - c X \right) = X^2 \left(\dfrac{u}{v + X} - c  \right)
\]</span></p>
<p>where <span class="math inline">\(c\)</span> is the density-dependent death rate. Assume that all parameters are positive; then, besides the trivial equilibrium <span class="math inline">\(X^\star =0\)</span>, we have a positive equilibrium <span class="math inline">\(X^\star = \frac{u}{c} - v &gt; 0\)</span>.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="ch1_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The graphical method allows to classify all equilibria according to their stability in a straightforward manner. Here’s an example with many equilibria:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="ch1_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise: Strong Allee effect
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>A stronger version of the Allee effect can be modeled as:</p>
<p><span class="math display">\[
\dfrac{dX}{dt} = X (X - \gamma)(\kappa - X)
\]</span></p>
<p>with <span class="math inline">\(0&lt;\gamma &lt; \kappa\)</span>.</p>
<ul>
<li>Interpret the parameters</li>
<li>Plot <span class="math inline">\(dX/dt\)</span> vs <span class="math inline">\(X\)</span>, and identify all equilibria</li>
<li>Classify the equilibria according to their stability</li>
</ul>
</div>
</div>
</div>
</section>
<section id="local-asymptotic-stability" class="level3">
<h3 class="anchored" data-anchor-id="local-asymptotic-stability">Local asymptotic stability</h3>
<p>You might have noticed that, when performing the graphical analysis above, and equilibrium is stable if <span class="math inline">\(dx/dt\)</span> has a negative slope at <span class="math inline">\(x^\star\)</span>. Here we formalize this notion, by considering small perturbations of the system resting at an equilibrium.</p>
<ul>
<li>Take an ODE <span class="math inline">\(dx/dt = f(x)\)</span></li>
<li>The system is resting at an equilibrium <span class="math inline">\(x^\star\)</span></li>
<li>We perturb the system, and track the dynamics when starting at <span class="math inline">\(x(0) = x^\star + \epsilon\)</span>, where <span class="math inline">\(\epsilon\)</span> (the perturbation) is taken to be sufficiently small <span class="math inline">\(\| \epsilon \| \ll 1\)</span></li>
<li>We write <span class="math inline">\(\Delta x(0) = x(0) - x^\star\)</span></li>
<li>We derive the dynamics for <span class="math inline">\(\Delta x\)</span>:</li>
</ul>
<p>By chain rule,</p>
<p><span class="math display">\[
\begin{aligned}
\dfrac{d \Delta x}{dt} &amp;= \dfrac{d \Delta x}{dx} \dfrac{d x}{dt} \\
&amp;= 1 \dfrac{d x}{dt}\\
&amp;= f(x)\\
&amp;= f(\Delta x + x^\star)
\end{aligned}
\]</span> Where we have substituted <span class="math inline">\(x = \Delta x + x^\star\)</span>.</p>
<ul>
<li>Now we approximate the function <span class="math inline">\(f(\Delta x + x^\star)\)</span> by Talyor expanding.</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Taylor series
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>We can approximate the behavior of a (infinitely differentiable) function in the vicinity of a point <span class="math inline">\(a\)</span> by a power series:</p>
<p><span class="math display">\[
f(x) = f(a) + \dfrac{1}{1!} \left. \dfrac{df(x)}{dx} \right|_a (x-a)+ \dfrac{1}{2!} \left. \dfrac{d^2f(x)}{dx^2} \right|_a (x-a)^2+ \dfrac{1}{3!} \left. \dfrac{d^3f(x)}{dx^3} \right|_a (x-a)^3 + \ldots
\]</span> where <span class="math inline">\(n! = n (n-1)(n-2)\ldots 1\)</span> is the factorial function and the derivatives are evaluated at <span class="math inline">\(a\)</span>. When we choose <span class="math inline">\(a=0\)</span> this is called the Maclaurin series.</p>
<p><strong>Example</strong></p>
<p>Expand <span class="math inline">\(e^x\)</span> around <span class="math inline">\(0\)</span>:</p>
<p><span class="math display">\[
\begin{aligned}
e^x &amp;= e^0 + \left. e^x\right|_0 x + \frac{1}{2}\left. e^x\right|_0 x^2  + \frac{1}{6}\left. e^x\right|_0 x^3 + \ldots\\
&amp;=1 + x + \frac{1}{2} x^2  + \frac{1}{6}x^3 + \ldots\\
&amp;=\sum_{k=0}^\infty \frac{x^k}{k!}
\end{aligned}
\]</span></p>
</div>
</div>
</div>
<p>We want to Taylor-expand <span class="math inline">\(f(x) = f(\Delta x + x^\star)\)</span> around <span class="math inline">\(x^\star\)</span>:</p>
<p><span class="math display">\[
f(x) = f(x^\star) + \left.\dfrac{d f(x)}{d x}\right|_{x^\star} (x - x^\star) + \dfrac{1}{2}\left.\dfrac{d^2 f(x)}{d x^2}\right|_{x^\star} (x - x^\star)^2 + \ldots
\]</span> Note that <span class="math inline">\(f(x^\star) = 0\)</span> by the definition of an equilibrium. If the deviation is small, we can neglect all the higher-order terms, obtaining:</p>
<p><span class="math display">\[
\dfrac{d \Delta x}{dt} = f(x) \approx \left.\dfrac{d f(x)}{d x}\right|_{x^\star} \Delta x
\]</span></p>
<p>which is the equation of the exponential growth model, with <span class="math inline">\(\rho = \left.\dfrac{d f(x)}{d x}\right|_{x^\star}\)</span>. Then, the solution is <span class="math inline">\(\Delta x(t) = \Delta x(0) e^{\rho t}\)</span>, and the deviation from the equilibrium goes to zero (i.e., the system goes back to <span class="math inline">\(x^\star\)</span>) whenever <span class="math inline">\(\rho &lt; 0\)</span>.</p>
<p>For example, take the logistic growth model and evaluate the stability of <span class="math inline">\(x^\star = 1\)</span>; we have:</p>
<p><span class="math display">\[
\left.\dfrac{d f(x)}{d x}\right|_{x^\star} = \left.\dfrac{d (x - x^2)}{d x}\right|_{x^\star} = \left.(1 - 2x)\right|_{x^\star} = -1
\]</span></p>
<p>and thus the equilibrium is <em>locally asymptotically stable</em>. Locally, because we have considered very small deviations from the equilibrium, and asymptotic because convergence only happens eventually.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise: Stability of equilibria for strong Allee effect
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Take the function for the Allee effect in the previous exercise:</p>
<p><span class="math display">\[
\dfrac{dX}{dt} = X (X - \gamma)(\kappa - X)
\]</span></p>
<p>Use local stability analysis to show that the system has three equilibria, of which two are locally stable.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise: Stability of model with weak Allee effect
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Now analyze the stability of the model with weak Allee effects:</p>
<p><span class="math display">\[
\dfrac{dX}{dt} = X^2 \left(\dfrac{u}{v + X} - c  \right)
\]</span></p>
<p>Assuming that <span class="math inline">\(u/c &gt; v\)</span>. You will find that the analysis of the equilibrium <span class="math inline">\(X^\star = 0\)</span> is inconclusive; expand the function <span class="math inline">\(d\Delta X/dt\)</span> to include higher-order terms to determine the stability of the equilibrium.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise: Levins’ metapopulation model
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>In 1969, when he was a professor at the University of Chicago, Richard Levins proposed a model for metapopulation dynamics. The idea is that in a landscape there are numerous patches of suitable habitat that can be colonized by a given species. Each population in a patch undergoes extinction with a certain rate, and can colonize other patches by sending propagules to them. Because there are many patches, we track the proportion of occupied patches <span class="math inline">\(0 \leq p(t) \leq 1\)</span>; the proportion of empty patches is therefore <span class="math inline">\(1 - p(t)\)</span>. If individuals disperse to a random patch when leaving an occupied patch, the rate of colonization will be proportional to the product <span class="math inline">\(\gamma\, p(t)(1-p(t))\)</span> (i.e., <span class="math inline">\(\gamma\, p(t)\)</span> is the rate at which propagules are produced, and <span class="math inline">\(1-p(t)\)</span> is the rate at which they land on an empty patch). The rate at which patches are vacated, the extinction rate, is <span class="math inline">\(\delta\)</span>. The model can be written as:</p>
<p><span class="math display">\[
\dfrac{d p(t)}{dt} = \gamma\,p(t)(1 - p(t)) - \delta\, p(t)
\]</span></p>
<ul>
<li>Find the equilibria</li>
<li>Determine their stability</li>
<li>Show that the equation is equivalent to that for the logitstic growth</li>
</ul>
</div>
</div>
</div>
</section>
<section id="global-asymptotic-stability" class="level3">
<h3 class="anchored" data-anchor-id="global-asymptotic-stability">Global Asymptotic Stability</h3>
<p>In certain models, we can show that whenever the population starts at a positive value, it will always reach a certain equilibrium <span class="math inline">\(x^\star\)</span>. In this case, we say the equilibrium is globally asymptotically stable.</p>
<p>Because as we said solving differential equations is in general very difficult, and in many cases of interest impossible, we employ a proxy function, called a Lyapunov function.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Lyapunov functions
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>We want to prove that all trajectories originating at <span class="math inline">\(x(0) &gt; 0\)</span> eventually converge to <span class="math inline">\(x^\star\)</span>. If we can find a function <span class="math inline">\(V\)</span> such that:</p>
<ul>
<li><span class="math inline">\(V(x(t)) \geq 0\)</span> for all <span class="math inline">\(x(t) &gt; 0\)</span></li>
<li><span class="math inline">\(V(x(t)) = 0\)</span> if and only if <span class="math inline">\(x(t) = x^\star\)</span></li>
<li><span class="math inline">\(\dfrac{d V(x(t))}{dt} \leq 0\)</span> for all <span class="math inline">\(t\)</span> and</li>
<li><span class="math inline">\(\dfrac{d V(x(t))}{dt} = 0\)</span> if and only if <span class="math inline">\(x(t) = x^\star\)</span></li>
</ul>
<p>then <span class="math inline">\(x^\star\)</span> is globally asymptotically stable: all trajectories starting at a positive point will converge to it.</p>
<p>The logic of this procedure is to identify a suitable function <span class="math inline">\(V\)</span> that is positive everywhere but at the equilibrium, and is constantly declining in time; then necessarily the function will eventually reach zero, which is attained only at equilibrium.</p>
<p><strong>Example</strong></p>
<p><span class="math inline">\(V(x(t)) = (x(t) - x^\star)^2\)</span> is a Lyapunov function that can be used to prove that the logistic growth model <span class="math inline">\(dx/dt = x(1-x)\)</span> has an equilibrium <span class="math inline">\(x^\star = 1\)</span> that is globally asymptotically stable.</p>
<ul>
<li><span class="math inline">\(V(x(t))\)</span> is always nonnegative, and is zero only at <span class="math inline">\(x(t) = x^\star = 1\)</span></li>
<li>The derivative of <span class="math inline">\(V(x(t))\)</span> w.r.t. time is:</li>
</ul>
<p><span class="math display">\[
\begin{aligned}
\dfrac{dV(t)}{dt} &amp;= \dfrac{dV(t)}{dx(t)}\dfrac{dx(t)}{dt}\\
&amp;= 2(x(t) - x^\star)\dfrac{dx(t)}{dt}\\
&amp;=2(x(t)-1) x(t)(x(t)-1)\\
&amp;=2 x(t) (x(t)-1)^2 \geq 0
\end{aligned}
\]</span></p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-13-contents" aria-controls="callout-13" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise: Global stability of logistic growth
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-13" class="callout-13-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Show that <span class="math inline">\(V(x(t)) = x(t) - 1 - \log x(t)\)</span> is a Lyapunov function that can be used to prove the global stability of <span class="math inline">\(x^\star = 1\)</span> for the logistic growth model <span class="math inline">\(dx/dt = x(1-x)\)</span>.</p>
<ul>
<li>Prove that <span class="math inline">\(V \geq 0\)</span>, with equality only at equilibrium</li>
<li>Prove that <span class="math inline">\(dV/dt \leq 0\)</span>, with equality only at equilibrium</li>
</ul>
</div>
</div>
</div>
</section>
<section id="long-term-behavior" class="level3">
<h3 class="anchored" data-anchor-id="long-term-behavior">Long-term behavior</h3>
<p>Autonomous, first-order ODE models with a single variable can have only two types of behavior: a) <span class="math inline">\(x(t)\)</span> eventually reaches a fixed point and remains there; b) <span class="math inline">\(x(t)\)</span> goes to <span class="math inline">\(\pm \infty\)</span>. This is a consequence of an important mathematical fact: if <span class="math inline">\(dx(t)/dt = f(x(t))\)</span> and the function <span class="math inline">\(f(x(t))\)</span> is “smooth” (e.g., continuously differentiable) then the solution for the ODE exists and <em>is unique</em>. This means that the equation can cross each point <span class="math inline">\(x(t) = \alpha\)</span> only once, or infinitely many times. In contrast, discrete models with a single variable can have very interesting behavior.</p>
</section>
</section>
<section id="discrete-time-models" class="level2">
<h2 class="anchored" data-anchor-id="discrete-time-models">Discrete-time models</h2>
<p>We have so far analyzed models where the growth of a population is described by an ordinary differential equation. However, for particular situations, and especially for species with nonoverlapping generations, a discrete-time approach would be more suitable.</p>
<section id="graphical-methods-cobwebbing" class="level3">
<h3 class="anchored" data-anchor-id="graphical-methods-cobwebbing">Graphical Methods: Cobwebbing</h3>
<p>To understand whether a discrete model is stable, we analyze the plot of <span class="math inline">\(x_{t+1}\)</span> against <span class="math inline">\(x_t\)</span>, superimposed on the diagonal (<span class="math inline">\(x_{t+1}=x_{t}\)</span>). We use these two curves to “cobweb”:</p>
<ul>
<li><p>Starting from an initial condition <span class="math inline">\(x_t=x(0)\)</span> (some point on the x-axis), we draw a line to the model’s projection of the population at the next time step (<span class="math inline">\(x_{t+1}\)</span>)</p></li>
<li><p>We then set <span class="math inline">\(x_t=x_{t+1}\)</span> to obtain the population in the next time step. To speed the process along, rather than lifting our pencils to draw <span class="math inline">\(x_{t+1}\)</span> at <span class="math inline">\(x_t\)</span> on the x-axis, we can simply draw a horizontal line from <span class="math inline">\(x_{t+1}\)</span> back to the diagonal (which shows <span class="math inline">\(x_{t+1}=x_t\)</span>) and then move vertically to get the next <span class="math inline">\(x_{t+1}\)</span></p></li>
<li><p>With enough iterations, this process reveals whether the population converges to a fixed point or does something more elaborate, and if this trajectory involves oscillations. Note that at a fixed point, <span class="math inline">\(x_{t+1}=x_t=x^\star\)</span>.</p></li>
</ul>
<p>We can use this approach for any map (discrete-time model) of <span class="math inline">\(x_{t+1}\)</span> to <span class="math inline">\(x_t\)</span>, although cobwebbing suffers the disadvantage of requiring a lot of manual labor to explore the asymptotic behavior. To explore its uses further, we’ll consider one of the most basic and important density-dependent, discrete-time models: the logistic map.</p>
</section>
<section id="the-logistic-map" class="level3">
<h3 class="anchored" data-anchor-id="the-logistic-map">The logistic map</h3>
<p>This is a model with a very similar formulation to the logistic growth ODE above:</p>
<p><span class="math display">\[
x_{t+1} = r\, x_t (1 - x_t)
\]</span></p>
<p>With <span class="math inline">\(x_t &gt; 0\)</span> and <span class="math inline">\(r &gt; 0\)</span>. When <span class="math inline">\(x_t &gt; 1\)</span>, the population will decline; therefore it makes sense to start the population at a value <span class="math inline">\(0&lt;x_0&lt;1\)</span>. For these values, the population might grow only if <span class="math inline">\(r &gt; 1\)</span> (i.e., we want <span class="math inline">\(x_{t+1} &gt; x_t\)</span> for growth).</p>
<p>Let’s try our hand at cobwebbing: set <span class="math inline">\(x_0 = 1/2\)</span> and <span class="math inline">\(r = 3/2\)</span>. The cobwebbing plot becomes:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="ch1_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>showing that the population declines and then stops at an equilibrium. We can compute the equilibrium by setting <span class="math inline">\(x_{t+1} = x_t = x^\star\)</span>:</p>
<p><span class="math display">\[
\begin{aligned}
x^\star &amp;= r\, x^\star (1 - x^\star)\\
1 &amp;= r\, (1 - x^\star)\\
x^\star &amp;= 1 - \frac{1}{r}
\end{aligned}
\]</span></p>
<p>Thus, a feasible (positive) equilibrium is found only for <span class="math inline">\(r &gt; 1\)</span>, as expected. In the example above, the equilibrium is reached without oscillations. Let’s try the cobweb for a larger <span class="math inline">\(r = 5/2\)</span></p>
<div class="cell">
<div class="cell-output-display">
<p><img src="ch1_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Now the solution <span class="math inline">\(x^\star = 1 - \frac{2}{5} = \frac{3}{5}\)</span> is reached after oscillating above and below this value.</p>
</section>
<section id="stability-of-equilibria" class="level3">
<h3 class="anchored" data-anchor-id="stability-of-equilibria">Stability of equilibria</h3>
<p>We want to determine whether <span class="math inline">\(x^\star\)</span> is stable for a given map (discrete-time model) <span class="math inline">\(x_{t+1} = f(x_t)\)</span>, with <span class="math inline">\(f(x^\star)=x^\star\)</span>. In particular, we want to determine whether when we initialize the system close to <span class="math inline">\(x^\star\)</span> we converge back to <span class="math inline">\(x^\star\)</span>.</p>
<p>Take <span class="math inline">\(x_t = x^\star + \epsilon_t\)</span>, where <span class="math inline">\(\epsilon_t\)</span> is small. Then we have</p>
<p><span class="math display">\[
\begin{aligned}
x_{t+1} &amp;= f(x_t)\\
x^\star + \epsilon_{t+1} &amp;= f(x^\star + \epsilon_t)\\
x^\star + \epsilon_{t+1} &amp;\approx f(x^\star) + \left. \dfrac{d f(x_t)}{dx_t}\right|_{x^\star} (x_t - x^\star) \\
x^\star + \epsilon_{t+1} &amp;\approx x^\star + \left. \dfrac{d f(x_t)}{dx_t}\right|_{x^\star} \epsilon_t\\
\epsilon_{t+1} &amp;\approx \left. \dfrac{d f(x_t)}{dx_t}\right|_{x^\star} \epsilon_t\\
\end{aligned}
\]</span></p>
<p>which is the very first model we have written. We have:</p>
<p><span class="math display">\[
\epsilon_{t+k} = \rho^{k} \epsilon_t
\]</span></p>
<p>with <span class="math inline">\(\rho = \left. \dfrac{d f(x_t)}{dx_t}\right|_{x^\star}\)</span>. We have that</p>
<p><span class="math display">\[
\lim_{k \to \infty} \epsilon_{t+k} = 0 \quad \text{if} \, |\rho| &lt; 1
\]</span></p>
<p>Thus, the equilibrium is stable if and only if the absolute value of <span class="math inline">\(\left. \dfrac{d f(x_t)}{dx_t}\right|_{x^\star}\)</span> is less than 1. If this value is greater than 1, then the equilibrium is unstable: small perturbations will amplify (at least initially); if the value is exactly 1, the analysis is inconclusive, and we might want to consider including higher-order terms in the Taylor expansion above.</p>
<p><strong>Example</strong></p>
<p>Take <span class="math inline">\(r = 2\)</span>, and show that the equilibrium <span class="math inline">\(x^\star = 1/2\)</span> is stable. We take the derivative:</p>
<p><span class="math display">\[
\rho = \left.\dfrac{d f(x_t)}{d x_t} \right|_{x^\star} = r \left. \dfrac{d (x_t (1- x_t))}{d x_t}\right|_{x^\star} = \left. r (1 - 2 x_t)\right|_{x^\star}
\]</span></p>
<p>and substitute the values of <span class="math inline">\(r\)</span> and <span class="math inline">\(x_t = x^\star = 1/2\)</span>. We obtain <span class="math inline">\(\rho = 0\)</span> and thus the equilibrium is stable. In fact, we see that, for any value of <span class="math inline">\(r &gt; 0\)</span> leading to a feasible equilibrium, we have:</p>
<p><span class="math display">\[
\rho = r \left(1 - 2 \left(1 - \frac{1}{r} \right) \right) = 2 - r
\]</span></p>
<p>and thus whenever <span class="math inline">\(|2 - r| &lt; 1\)</span> we have a stable equilibrium. This is true whenever <span class="math inline">\(3&gt; r &gt;1\)</span>.</p>
</section>
<section id="periodic-orbits" class="level3">
<h3 class="anchored" data-anchor-id="periodic-orbits">Periodic orbits</h3>
<p>If we make <span class="math inline">\(r\)</span> even larger, we find new behavior. For example, take <span class="math inline">\(r = 10/3\)</span>, <span class="math inline">\(x_0 = 3/4\)</span></p>
<div class="cell">
<div class="cell-output-display">
<p><img src="ch1_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>After a few oscillations, the system sets into a cycle, alternating between two values. This is best seen by plotting a time-series, in which we have the (discrete) time in the x-axis, and the value <span class="math inline">\(x_t\)</span> on the y-axis:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="ch1_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>What are the two values? To find them, we can set <span class="math inline">\(x_{t+2} = x_{t}\)</span> making sure that <span class="math inline">\(x_{t+1} \neq x_t\)</span>. Take:</p>
<p><span class="math display">\[
\begin{aligned}
x_{t+2} &amp;= x_t\\
f(x_{t+1}) &amp;= x_t\\
f(f(x_t)) &amp;= x_t\\
f^{(2)}(x_t) &amp;= x_t
\end{aligned}
\]</span></p>
<p>For the logistic map, we have:</p>
<p><span class="math display">\[
\begin{aligned}
x_t &amp;= r\,x_{t+1}\,(1 - x_{t+1})\\
&amp;= r\, r\, x_t (1 - x_t)\, (1 -  r\, x_t (1 - x_t))\\
&amp;= r^2 x_t (1-x_t) (1 -  r\, x_t (1 - x_t))
\end{aligned}
\]</span></p>
<p>When we discard the solution <span class="math inline">\(x_t =0\)</span>, we obtain the cubic polynomial:</p>
<p><span class="math display">\[
-r^3 x_t^3+2 r^3 x_t^2-(r+1) r^2 x_t+r^2-1= 0
\]</span></p>
<p>We can factor out the solution <span class="math inline">\(x_t = 1 - \frac{1}{r}\)</span>, which we know already, obtaining:</p>
<p><span class="math display">\[
\begin{aligned}
r^3 x_t^2 - r^2 (1 + r) x_t + r (1 + r) &amp;= 0\\
r^2 x_t^2 - r (1 + r) x_t + (1 + r) &amp;= 0
\end{aligned}
\]</span></p>
<p>Yielding:</p>
<p><span class="math display">\[
x_c = \dfrac{r +1 \pm \sqrt{(r-3) (r+1)}}{2 r}
\]</span></p>
<p>Both values are greater than zero whenever <span class="math inline">\(r \geq 3\)</span>. We can investigate the stability of the cycle, we can take the derivative w.r.t. <span class="math inline">\(x_t\)</span> of <span class="math inline">\(f^{(2)}(x_t)\)</span>, and plug in one of the two values above:</p>
<p><span class="math display">\[
\begin{aligned}
\rho &amp;= \left.\dfrac{d f^{(2)}(x_t)}{d x_t} \right|_{x_c}\\
&amp;= \left. \left(\dfrac{d}{d x_t} r^2 x_t (1-x_t) (1 -  r\, x_t (1 - x_t)) \right)\right|_{x_c}\\
&amp;= \left. (r^2 (1 - 2 x_t)(1 - 2 r x_t(1-x_t))) \right|_{x_c}
\end{aligned}
\]</span></p>
<p>Substituting the larger value of <span class="math inline">\(x_c\)</span>, we eventually find:</p>
<p><span class="math display">\[
\rho = 4 - r (r - 2)
\]</span></p>
<p>The period-2 cycle is stable whenever <span class="math inline">\(|\rho| &lt; 1\)</span>. If we assume that <span class="math inline">\(r \geq 3\)</span> (required for the existence of the cycle in the first place), we have:</p>
<p><span class="math display">\[
3 &lt; \rho &lt; 1 + \sqrt{6} \approx 3.45
\]</span></p>
<p>The period-2 orbits are therefore stable in this range. What happens beyond this value of <span class="math inline">\(r\)</span>? Take <span class="math inline">\(r = 3.5\)</span> and cobweb:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="ch1_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Now we have that the system oscillates between four values, as seen from the time-series (where we have removed the first 250 time steps for clarity):</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="ch1_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Now we have a period-4 solution, which is stable until <span class="math inline">\(1 + \sqrt{6} &lt; r &lt; 3.701\)</span>, at which point we find period-8 cycles:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="ch1_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="chaos" class="level3">
<h3 class="anchored" data-anchor-id="chaos">Chaos</h3>
<p>The system can yield cycles of period three. Take <span class="math inline">\(r = 1 + 2 \sqrt{2}\)</span>, and plot the time series:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="ch1_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>A famous result (Sharkovsky’s theorem, <em>Ukrainian Math J</em>, 1964) states that if a map has cycles of period 3, then it must have cycles of every other period. Li and Yorke (“Period Three Implies Chaos”. <em>Am. Math. Monthly</em>, 1975) showed that indeed a period-three implies infinitely many trajectories that do not have a period, and oscillate without ever completing a cycle. We call this phenomenon chaos.</p>
<p>Chaos is aperiodic long-term behavior in a deterministic system that exhibits sensitive dependence to initial conditions. In particular, one can prove that in a chaotic regime, if we start with two initial conditions that are very close to each other (their distance being <span class="math inline">\(\Delta x_0\)</span>) we eventually find very different trajectories. In particular, when we have chaos:</p>
<p><span class="math display">\[
|\Delta x(t)| \approx e^{\lambda t}|\Delta x_0|
\]</span></p>
<p>with <span class="math inline">\(\lambda&gt;0\)</span> (the <strong>Lyapunov exponent</strong>).</p>
<p>To show this behavior, let’s plot two trajectories for the system when <span class="math inline">\(r = 3.675\)</span> and <span class="math inline">\(x_0 = 0.5\)</span> or <span class="math inline">\(x_0 = 0.4999\)</span>:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="ch1_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="bifurcation-diagram" class="level3">
<h3 class="anchored" data-anchor-id="bifurcation-diagram">Bifurcation diagram</h3>
<p>All these results can be summarized in a beautiful graph. We build it as follows:</p>
<ul>
<li>pick a value of <span class="math inline">\(r\)</span></li>
<li>starting from an arbitrary point, <span class="math inline">\(x_0 = 1/2\)</span>, compute <span class="math inline">\(x_t\)</span> for a large number of points, and discard the first part of the time series (transient dynamics)</li>
<li>locate and record the minima and maxima of the time series</li>
<li>plot <span class="math inline">\(r\)</span> (x-axis) against the location of the minima and maxima (y-axis)</li>
</ul>
<p>If the trajectories converge to an equilibrium, we will find a single point; if trajectories converge to a period-2 cycle, we will find two points; etc.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>logistic_map_ts <span class="ot">&lt;-</span> <span class="cf">function</span>(r, <span class="at">max_time =</span> <span class="dv">3000</span>, <span class="at">discard =</span> <span class="dv">2000</span>){</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  ts <span class="ot">&lt;-</span> <span class="fu">accumulate</span>(<span class="at">.x =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, max_time), <span class="at">.f =</span> <span class="cf">function</span>(xt, xtp1) r <span class="sc">*</span> xt <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span>xt))[discard<span class="sc">:</span>max_time]</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># discard points at which the trajectory repeats</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  difference <span class="ot">&lt;-</span> <span class="fu">abs</span>(ts <span class="sc">-</span> ts[<span class="dv">1</span>])</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  zz <span class="ot">&lt;-</span> <span class="fu">which</span>(difference <span class="sc">&lt;</span> <span class="dv">10</span><span class="sc">^-</span><span class="dv">6</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(zz) <span class="sc">&gt;</span> <span class="dv">1</span>) ts <span class="ot">&lt;-</span> ts[<span class="dv">1</span><span class="sc">:</span>zz[<span class="dv">2</span>]]</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">tibble</span>(<span class="st">'x'</span> <span class="ot">=</span> ts, <span class="st">'r'</span> <span class="ot">=</span> r))</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co"># load results if available</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">file.exists</span>(<span class="st">"data/logistic_bifurcation.RData"</span>)){</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">load</span>(<span class="st">"data/logistic_bifurcation.RData"</span>)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># compute the results (this will take some time...)</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  bifurcation_logistic_map <span class="ot">&lt;-</span> <span class="fu">map_df</span>(<span class="at">.x =</span> <span class="fu">seq</span>(<span class="fl">2.95</span>, <span class="fl">3.99</span>, <span class="at">by =</span> <span class="fl">0.001</span>), </span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">.f =</span> logistic_map_ts)  </span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># and save the file</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">save</span>(bifurcation_logistic_map, <span class="at">file =</span> <span class="st">"data/logistic_bifurcation.RData"</span>)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(bifurcation_logistic_map) <span class="sc">+</span> </span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> r, <span class="at">y =</span> x) <span class="sc">+</span> </span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">0.005</span>, <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span> </span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(r)) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="fu">expression</span>(x[t]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ch1_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-14-contents" aria-controls="callout-14" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise: Ricker model
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-14" class="callout-14-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>This period-doubling cascade to chaos is common to several models. Draw the bifurcation diagram for the Ricker model:</p>
<p><span class="math display">\[
x_{t+1} = x_t e^{r(1-x_t)}
\]</span></p>
<p>again taking values of <span class="math inline">\(r\)</span> between 1.95 and 4, and values of <span class="math inline">\(x_0\)</span> between 0 and 1.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-15-contents" aria-controls="callout-15" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Euler’s method
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-15" class="callout-15-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>When we want to compute trajectories for a differential equations, we face the problem that typically the equations cannot be solved. Computers get around this issue by carefully computing the trajectory for a <em>discrete-time</em> model. The simplest case is that of Euler’s method.</p>
<p>We want to compute the solution of <span class="math inline">\(dx(t)/dt = f(x(t))\)</span>. For sufficiently small <span class="math inline">\(\Delta t\)</span>, we can Taylor-expand <span class="math inline">\(x(t_0 + \Delta t)\)</span> around <span class="math inline">\(t_0\)</span>, obtaining:</p>
<p><span class="math display">\[
x(t_0 + \Delta t) \approx x(t_0) + \left. \dfrac{d x(t)}{dt}\right|_{t_0} \Delta t
\]</span></p>
<p>we know the value of <span class="math inline">\(x(t_0) = x_0\)</span>, and the function <span class="math inline">\(d x(t) / dt = f(x(t))\)</span>, and as such:</p>
<p><span class="math display">\[
x(t_0 + \Delta t) \approx x_0 + \Delta t \, f(x_0)
\]</span></p>
<p>We iterate this procedure again and again, drawing our trajectory. Naturally, taking smaller <span class="math inline">\(\Delta t\)</span> we should get better approximations, from a mathematical standpoint. In fact, one can show that the error we’re making is proportional to <span class="math inline">\(\Delta t\)</span>. However, reducing <span class="math inline">\(\Delta t\)</span> has two undesirable effects: first, the calculation time will increase accordingly; second, because computers have limited precision when representing numbers, at each step we will make round off errors, and these will accumulate faster when the step size is small.</p>
<p>In practice, when we use Euler’s method we assume that <span class="math inline">\(f(x)\)</span> is fixed during the step <span class="math inline">\(\Delta t\)</span> (which we now is generally not true). We can average across two points, yielding the so-called midpoint method:</p>
<p><span class="math display">\[
\begin{aligned}
y_{t + \Delta t} &amp;= x_t + \Delta_t f(x_t)\\
x_{t + \Delta t} &amp;= x_t + \frac{1}{2}(f(x_t) + f(y_{t + \Delta t}))
\end{aligned}
\]</span></p>
<p>where <span class="math inline">\(y_{t + \Delta t}\)</span> is what computed using Euler’s method, and the slope for the actual step is taken to be the average <span class="math inline">\(f(x)\)</span> at the beginning and end of the step. One can show that the error is now proportional to <span class="math inline">\((\Delta t)^2\)</span>, which is a good improvement.</p>
<p>The same logic applies when we take several intermediate steps, and average across them, as done for the <a href="https://en.wikipedia.org/wiki/Runge%E2%80%93Kutta_methods">Runge-Kutta methods</a>.</p>
<p>In fact, the best software tries to pick small <span class="math inline">\(\Delta t\)</span> when <span class="math inline">\(x(t)\)</span> is changing rapidly, and larger <span class="math inline">\(\Delta t\)</span> when <span class="math inline">\(x(t)\)</span> is changing slowly. These adaptive-step methods are the state-of-the-art, and are implemented in the package <code>deSolve</code> in <code>R</code>.</p>
</div>
</div>
</div>
</section>
</section>
<section id="classic-papers" class="level2">
<h2 class="anchored" data-anchor-id="classic-papers">Classic papers</h2>
<p>A brief paper discussing how to build models in biology:</p>
<ul>
<li>Richard Levins, 1966. <a href="https://www.jstor.org/stable/27836590"><em>The strategy of model building in population biology</em></a>. American Scientist 54:421-431</li>
</ul>
<p>This paper introduces the famous metapopulation model:</p>
<ul>
<li>Richard Levins, 1969. <a href="https://academic.oup.com/ae/article-abstract/15/3/237/255899"><em>Some demographic and genetic consequences of environmental heterogeneity for biological control</em></a>. Bull. Entomol. Soc. Am. 15:237–240.</li>
</ul>
<p>This paper shows the onset of chaos in simple discrete-time models:</p>
<ul>
<li>Robert M. May, 1976. <a href="https://www.nature.com/articles/261459a0"><em>Simple mathematical models with very complicated dynamics</em></a>. Nature 261:459-467</li>
</ul>
<p>This paper discusses how simple models relates to experimental data on population growth:</p>
<ul>
<li>Michael P. Hassell, John H. Lawton, Robert M. May, 1976. <a href="https://www.jstor.org/stable/3886"><em>Patterns of dynamical behavior in single species populations</em></a>. Journal of Animal Ecology 45:471-486</li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>